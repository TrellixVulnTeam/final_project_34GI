<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    {% load static %}
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'js/jquery-3.4.1.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js'%}"></script>
    <title>Upload and View Your Results</title>
</head>
<body>

    <button class="btn-default"><a href="{% url 'index' %}">back to main page</a></button>
    <p></p>

    {# uploading pics #}
    <form enctype="multipart/form-data" action="{% url "upload" %}"  method="POST">
{#    action="{% url "save_pic" %}"#}
    {% csrf_token %}
    {% for field in form %}
        {{ field.label }}
         {{ field }}
    {% endfor %}
    <br><br>
    <button type="submit">upload</button>
    </form>
    <p></p>

    {% if uploaded %}
        <p>如下是你上传的图片：</p>
        <img src="" alt="uploaded image" id="upload_pic">

        <script>
        // 使用ajax实时预览上传照片
        let xmlHttp = new XMLHttpRequest();
        xmlHttp.open('GET', '{% url 'image' pic_id %}', true);     // 异步获取图片
        xmlHttp.responseType = "blob";  // 要求二进制流返回以显示图片
        xmlHttp.send();

        xmlHttp.onreadystatechange=function () {
            if (xmlHttp.readyState === 4 && xmlHttp.status === 200) {
                // 从服务器以二进制流返回上传的图片结果
                document.getElementById('upload_pic').src = URL.createObjectURL(xmlHttp.response)
            }
        }
        </script>
    {% endif %}

</body>
</html>